{
  "schema_version": "1.0",
  "trial": {
    "id": "remap-cap",
    "version": "v2.4",
    "jurisdiction": ["AU", "NZ", "UK"],
    "effective_from": "2025-06-01T00:00:00Z"
  },
  "metadata": {
    "title": "REMAP-CAP Eligibility",
    "description": "Platform → CAP → Time Windows → Consent → Domain/Regimen resolution",
    "author": "Empiric",
    "created_at": "2025-06-26T00:00:00Z"
  },
  "variables": [
    {
      "id": "eCRF",
      "name": "patient_check_eCRF",
      "type": "BOOLEAN"
    },
    {
      "id": "new",
      "name": "different_patient",
      "type": "BOOLEAN"
    },
    {
      "id": "support.started_time",
      "name": "randomised_since",
      "type": "TIME_WINDOW"
    },
    {
      "id": "cap.fever",
      "name": "feat_fever",
      "type": "BOOLEAN"
    },
    {
      "id": "cap.cough",
      "name": "feat_cough",
      "type": "BOOLEAN"
    },
    {
      "id": "cap.dyspnoea",
      "name": "feat_dyspnoea",
      "type": "BOOLEAN"
    },
    {
      "id": "pregnancy.status",
      "name": "pregnancy_ok",
      "type": "BOOLEAN"
    },
    {
      "id": "cap.assessment",
      "name": "REMAP_CAP_Platform_eligible",
      "type": "BOOLEAN"
    },
    {
      "id": "cap.registry",
      "name": "participating_registry_domain",
      "type": "BOOLEAN"
    },
    {
      "id": "antibiotics_1",
      "name": "antibiotics_1",
      "type": "NUMBER"
    },
    {
      "id": "antibiotics_2",
      "name": "antibiotics_2",
      "type": "NUMBER"
    },
    {
      "id": "steroids_1",
      "name": "steroids_1",
      "type": "NUMBER"
    },
    {
      "id": "steroids_2",
      "name": "steroids_2",
      "type": "NUMBER"
    },
    {
      "id": "beta_lactam_allergy",
      "name": "regimen_matrix",
      "type": "BOOLEAN"
    },
    {
      "id": "phys",
      "name": "shock_or_severe",
      "type": "NUMBER"
    },
    {
      "id": "consent.required",
      "name": "consent",
      "type": "BOOLEAN"
    },
    {
      "id": "screened_patient",
      "name": "screened_patient",
      "type": "BOOLEAN"
    }
  ],
  "domain_catalog": [
    { "id": "antibiotics", "active": true },
    { "id": "steroids", "active": true },
    { "id": "anticoag", "active": true }
  ],
  "regimen_catalog": [
    { "id": "abx_a", "domain_id": "antibiotics", "label": "ABX Regimen A" },
    { "id": "abx_b", "domain_id": "antibiotics", "label": "ABX Regimen B" },
    {
      "id": "steroid_low",
      "domain_id": "steroids",
      "label": "Low-dose Steroid"
    }
  ],
  "logic": {
    "root": "platform_gate",
    "nodes": {
      "patient_check_eCRF": {
        "name": "Patient demographic checks",
        "cate": "1",
        "type": "BOOLEAN",
        "input": { "var": "eCRF" },
        "reason_on_fail": "Patient has not entered eCRF"
      },
      "database_checking": {
        "name": "Are they already in the database",
        "cate": "1",
        "type": "DATABASE",
        "input": { "var": "database" },
        "reason_on_fail": "Patient has not in database"
      },
      "different_patient": {
        "name": "It is a different patient",
        "cate": "1",
        "type": "BOOLEAN",
        "input": { "var": "new" },
        "reason_on_fail": "different_patient"
      },
      "randomised_since": {
        "name": "Has it been more than 90 days since they were randomised",
        "cate": "2",
        "type": "TIME_WINDOW",
        "input": { "var": "support.started_time" },
        "window": { "max_hours_since": 90 },
        "reason_on_fail": "randomised_sine"
      },
      "CAP_assessment": {
        "name": "CAP clinical feature",
        "cate": "2",
        "type": "ANY",
        "children": ["feat_fever", "feat_cough", "feat_dyspnoea"],
        "reason_on_fail": "CAP_assessment"
      },
      "feat_fever": {
        "name": "CAP fever",
        "cate": "2",
        "type": "BOOLEAN",
        "input": { "var": "cap.fever" }
      },
      "feat_cough": {
        "name": "CAP cough",
        "cate": "2",
        "type": "BOOLEAN",
        "input": { "var": "cap.cough" }
      },
      "feat_dyspnoea": {
        "name": "CAP dyspnoea",
        "cate": "2",
        "type": "BOOLEAN",
        "input": { "var": "cap.dyspnoea" }
      },
      "pregnancy_ok": {
        "name": "Pregnancy",
        "cate": "2",
        "type": "NOT",
        "input": { "var": "pregnancy.status" },
        "reason_on_fail": "Pregnancy excludes from ABX domain"
      },
      "REMAP_CAP_Platform_eligible": {
        "name": "REMAP-CAP Platform eligible",
        "cate": "2",
        "type": "BOOLEAN",
        "input": { "var": "cap.assessment" },
        "reason_on_fail": "REMAP_CAP_Platform_eligible"
      },
      "participating_registry_domain": {
        "name": "Is the site participating in the Registry domain",
        "cate": "3",
        "type": "BOOLEAN",
        "input": { "var": "cap.registry" },
        "reason_on_fail": "participating_registry_domain"
      },
      "antibiotics_1_2": {
        "name": "Antibiotics 1 or 2",
        "cate": "3",
        "type": "ANY",
        "children": ["antibiotics_1", "antibiotics_2"],
        "reason_on_fail": "Antibiotics 1 or 2 error"
      },
      "steroids_1_2": {
        "name": "Steroids 1 or 2",
        "cate": "3",
        "type": "ANY",
        "children": ["steroids_1", "steroids_2"],
        "reason_on_fail": "Steroids 1 or 2 error"
      },
      "domain_eligibility": {
        "name": "Domain level eligibility assessment",
        "cate": "4",
        "type": "DOMAIN_MAP",
        "items": [
          {
            "domain_id": "antibiotics",
            "rule": "antibiotics_1_2"
          },
          {
            "domain_id": "steroids",
            "rule": "steroids_1_2"
          }
        ]
      },
      "antibiotics_1": {
        "name": "Antibiotics 1",
        "cate": "3",
        "type": "COMPARE",
        "operator": ">",
        "input": { "var": "antibiotics_1" },
        "right": { "const": 10 }
      },
      "antibiotics_2": {
        "name": "Antibiotics 2",
        "cate": "3",
        "type": "COMPARE",
        "operator": ">",
        "input": { "var": "antibiotics_2" },
        "right": { "const": 20 }
      },
      "steroids_1": {
        "name": "Steroids 1",
        "cate": "3",
        "type": "COMPARE",
        "operator": ">",
        "input": { "var": "steroids_1" },
        "right": { "const": 10 }
      },
      "steroids_2": {
        "name": "Steroids 2",
        "cate": "3",
        "type": "COMPARE",
        "operator": ">",
        "input": { "var": "steroids_2" },
        "right": { "const": 20 }
      },
      "beta_lactam_allergy_checking": {
        "name": "beta lactam allergy",
        "cate": "2",
        "type": "BOOLEAN",
        "input": { "var": "beta_lactam_allergy" },
        "reason_on_fail": "beta_lactam_allergy_checking error"
      },
      "regimen_matrix": {
        "name": "Eligible for 2 or more REGIMEN",
        "cate": "4",
        "type": "REGIMEN_RESOLVE",
        "input": {
          "eligible_domains_ref": "domain_eligibility"
        },
        "constraints": [
          {
            "regimen_id": "abx_a",
            "exclude_if": "beta_lactam_allergy_checking",
            "reason_on_exclude": "Allergy to beta-lactam"
          }
        ],
        "require_min_regimens": 2,
        "reason_on_fail": "NER – no eligible regimen set"
      },
      "shock_or_severe": {
        "name": "Shock or Severe",
        "cate": "3",
        "type": "COMPARE",
        "operator": "<=",
        "input": { "var": "phys" },
        "right": { "const": 150 }
      },
      "consent": {
        "name": "Do we need consent",
        "cate": "5",
        "type": "BOOLEAN",
        "input": { "var": "consent.required" },
        "reason_on_fail": "consent"
      },
      "screened_patient": {
        "name": "Master List of screened patient's",
        "type": "BOOLEAN",
        "cate": "5",
        "input": { "var": "screened_patient" },
        "reason_on_fail": "screened patient"
      },
      "consent_gate": {
        "name": "Consent gate",
        "cate": "5",
        "type": "IF",
        "cond": "patient_check_eCRF",
        "then": "domain_eligibility",
        "else": "participating_registry_domain"
      }
    },
    "flow": [
      {
        "id": "database_checking",
        "on_fail": { "next": "CAP_assessment" },
        "on_pass": { "next": "different_patient" }
      },
      {
        "id": "patient_check_eCRF",
        "on_pass": { "next": "database_checking" },
        "start": true
      },
      {
        "id": "different_patient",
        "on_fail": { "next": "randomised_since" },
        "on_pass": { "next": "pregnancy_ok" }
      },
      {
        "id": "randomised_since",
        "on_fail": { "next": "CAP_assessment" },
        "on_pass": { "next": "pregnancy_ok" }
      },
      {
        "id": "CAP_assessment",
        "on_fail": {
          "next": "screened_patient"
        },
        "on_pass": { "outcome": "Registry" }
      },
      {
        "id": "pregnancy_ok",
        "on_fail": {
          "next": "shock_or_severe"
        },
        "on_pass": { "next": "REMAP_CAP_Platform_eligible" }
      },
      {
        "id": "shock_or_severe",
        "on_fail": { "outcome": "Registry" },
        "on_pass": { "next": "REMAP_CAP_Platform_eligible" }
      },
      {
        "id": "REMAP_CAP_Platform_eligible",
        "on_fail": {
          "next": "participating_registry_domain"
        },
        "on_pass": { "next": "domain_eligibility" }
      },
      {
        "id": "participating_registry_domain",
        "on_fail": { "outcome": "Registry", "message": "(Data linkage only)" },
        "on_pass": {
          "outcome": "Registry",
          "message": "(additional data collection)"
        }
      },
      {
        "id": "domain_eligibility",
        "on_pass": { "next": "regimen_matrix" }
      },
      {
        "id": "regimen_matrix",
        "on_fail": {
          "next": "participating_registry_domain"
        },
        "on_pass": { "next": "consent" }
      },
      {
        "id": "consent",
        "on_fail": { "next": "participating_registry_domain" },
        "on_pass": { "outcome": "Randomise" }
      }
    ]
  }
}
